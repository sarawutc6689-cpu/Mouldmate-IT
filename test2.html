<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>PM Calendar</title>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<style>
body {
  font-family: Arial;
  margin: 20px;
}
#mode-selector {
  margin-bottom: 10px;
}
#password-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: white;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  min-width: 300px;
}
.modal-content input {
  width: 80%;
  padding: 8px;
  margin: 10px 0;
  font-size: 16px;
}
.modal-content button {
  padding: 8px 16px;
  margin: 5px;
  cursor: pointer;
}
</style>
</head>
<body>

<div id="mode-selector">
  <select id="mode">
    <option value="user">User (ดูอย่างเดียว)</option>
    <option value="admin">Admin (แก้ไขได้)</option>
  </select>
  <span id="mode-status" style="margin-left: 10px; color: #666;">โหมด: User</span>
</div>

<div id="calendar"></div>

<div id="password-modal">
  <div class="modal-content">
    <h3>กรุณากรอกรหัสผ่าน Admin</h3>
    <input type="password" id="admin-password" placeholder="รหัสผ่าน">
    <div>
      <button id="password-submit">ตกลง</button>
      <button id="password-cancel">ยกเลิก</button>
    </div>
    <p id="password-error" style="color: red; display: none;">รหัสผ่านไม่ถูกต้อง</p>
  </div>
</div>

<script>
// รหัสผ่าน (เปลี่ยนเป็นรหัสที่ต้องการ)
const ADMIN_PASSWORD = "admin123";

let mode = 'user';
let calendar;

// สร้าง calendar
calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
  initialView: 'dayGridMonth',
  editable: false,
  selectable: false,

  events: [
    {
      title: 'PM Generator',
      start: '2026-02-05',
      color: '#1a73e8'
    },
    {
      title: 'PM Aircon',
      start: '2026-02-10',
      color: '#34a853'
    }
  ],

  eventClick(info) {
    alert(
      `PM: ${info.event.title}\nDate: ${info.event.start.toLocaleDateString()}`
    );
  },

  select(info) {
    if (mode !== 'admin') return;
    const title = prompt('PM Title');
    if (title) {
      calendar.addEvent({
        title,
        start: info.startStr,
        allDay: true
      });
    }
  }
});

calendar.render();

// อ้างอิง DOM elements
const modeSelect = document.getElementById('mode');
const modeStatus = document.getElementById('mode-status');
const passwordModal = document.getElementById('password-modal');
const adminPasswordInput = document.getElementById('admin-password');
const passwordSubmit = document.getElementById('password-submit');
const passwordCancel = document.getElementById('password-cancel');
const passwordError = document.getElementById('password-error');

// เมื่อเปลี่ยนโหมด
modeSelect.onchange = e => {
  const selectedMode = e.target.value;
  
  if (selectedMode === 'admin') {
    // แสดง modal รหัสผ่าน
    showPasswordModal();
  } else {
    // เปลี่ยนเป็นโหมด user
    switchToUserMode();
  }
};

// แสดง modal รหัสผ่าน
function showPasswordModal() {
  passwordModal.style.display = 'flex';
  adminPasswordInput.value = '';
  passwordError.style.display = 'none';
  adminPasswordInput.focus();
}

// ซ่อน modal รหัสผ่าน
function hidePasswordModal() {
  passwordModal.style.display = 'none';
}

// เปลี่ยนเป็นโหมด admin
function switchToAdminMode() {
  mode = 'admin';
  calendar.setOption('editable', true);
  calendar.setOption('selectable', true);
  modeStatus.textContent = 'โหมด: Admin';
  modeStatus.style.color = '#d32f2f';
  modeSelect.value = 'admin';
  hidePasswordModal();
}

// เปลี่ยนเป็นโหมด user
function switchToUserMode() {
  mode = 'user';
  calendar.setOption('editable', false);
  calendar.setOption('selectable', false);
  modeStatus.textContent = 'โหมด: User';
  modeStatus.style.color = '#666';
  modeSelect.value = 'user';
  hidePasswordModal();
}

// ตรวจสอบรหัสผ่าน
function checkPassword() {
  const enteredPassword = adminPasswordInput.value;
  
  if (enteredPassword === ADMIN_PASSWORD) {
    switchToAdminMode();
  } else {
    passwordError.style.display = 'block';
    adminPasswordInput.value = '';
    adminPasswordInput.focus();
  }
}

// Event listeners
passwordSubmit.onclick = checkPassword;

passwordCancel.onclick = () => {
  switchToUserMode();
};

adminPasswordInput.onkeypress = (e) => {
  if (e.key === 'Enter') {
    checkPassword();
  }
};

// ปิด modal เมื่อคลิกภายนอก
passwordModal.onclick = (e) => {
  if (e.target === passwordModal) {
    switchToUserMode();
  }
};
</script>

</body>
</html>
