<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PM Calendar - ระบบปฏิทินจัดการงานซ่อมบำรุง</title>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=IBM+Plex+Sans+Thai:wght@300;400;500&display=swap" rel="stylesheet">

<style>
:root {
  --primary-color: #4361ee;
  --primary-dark: #3a56d4;
  --secondary-color: #7209b7;
  --accent-color: #4cc9f0;
  --success-color: #4ade80;
  --warning-color: #f59e0b;
  --danger-color: #ef4444;
  --light-color: #f8fafc;
  --dark-color: #1e293b;
  --gray-color: #64748b;
  --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --radius: 12px;
  --transition: all 0.3s ease;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'IBM Plex Sans Thai', 'Kanit', sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  color: var(--dark-color);
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

/* Header Styles */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  padding: 20px 25px;
  background: white;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border-left: 6px solid var(--primary-color);
}

.header-title {
  display: flex;
  align-items: center;
  gap: 15px;
}

.header-title i {
  font-size: 32px;
  color: var(--primary-color);
}

.header-title h1 {
  font-family: 'Kanit', sans-serif;
  font-weight: 600;
  font-size: 28px;
  color: var(--dark-color);
}

.header-title span {
  color: var(--primary-color);
}

/* Control Panel Styles */
.control-panel {
  background: white;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 25px;
  margin-bottom: 30px;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
}

.mode-selector {
  display: flex;
  align-items: center;
  gap: 15px;
}

.mode-label {
  font-weight: 500;
  color: var(--dark-color);
  font-size: 16px;
}

.select-wrapper {
  position: relative;
}

.select-wrapper i {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--primary-color);
  pointer-events: none;
}

#mode {
  padding: 12px 45px 12px 20px;
  font-size: 16px;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  background-color: white;
  color: var(--dark-color);
  font-family: 'IBM Plex Sans Thai', sans-serif;
  font-weight: 400;
  cursor: pointer;
  appearance: none;
  min-width: 200px;
  transition: var(--transition);
}

#mode:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

#mode option {
  padding: 10px;
}

.mode-status {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 20px;
  border-radius: 50px;
  font-weight: 500;
  transition: var(--transition);
}

.mode-status.user {
  background-color: #e0f2fe;
  color: #0369a1;
}

.mode-status.admin {
  background-color: #fee2e2;
  color: #dc2626;
}

.mode-status i {
  font-size: 18px;
}

.stats-container {
  display: flex;
  gap: 20px;
}

.stat-box {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border-radius: 10px;
  padding: 15px 20px;
  min-width: 140px;
  border-left: 4px solid var(--primary-color);
  box-shadow: var(--shadow-light);
}

.stat-box h3 {
  font-size: 14px;
  color: var(--gray-color);
  margin-bottom: 5px;
  font-weight: 500;
}

.stat-box p {
  font-size: 24px;
  font-weight: 600;
  color: var(--dark-color);
}

/* Calendar Container */
.calendar-container {
  background: white;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 25px;
  margin-bottom: 30px;
  overflow: hidden;
}

#calendar {
  font-family: 'IBM Plex Sans Thai', sans-serif;
}

/* Modal Styles */
#password-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(5px);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-content {
  background: white;
  padding: 40px;
  border-radius: var(--radius);
  text-align: center;
  width: 90%;
  max-width: 450px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  animation: modalSlideIn 0.4s ease;
  border-top: 6px solid var(--primary-color);
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-icon {
  font-size: 48px;
  color: var(--primary-color);
  margin-bottom: 20px;
}

.modal-content h3 {
  font-family: 'Kanit', sans-serif;
  font-size: 24px;
  font-weight: 600;
  color: var(--dark-color);
  margin-bottom: 10px;
}

.modal-content p {
  color: var(--gray-color);
  margin-bottom: 25px;
  line-height: 1.6;
}

.password-input-container {
  position: relative;
  margin-bottom: 25px;
}

.password-input-container i {
  position: absolute;
  left: 18px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray-color);
  font-size: 18px;
}

#admin-password {
  width: 100%;
  padding: 16px 20px 16px 50px;
  font-size: 16px;
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  transition: var(--transition);
  font-family: 'IBM Plex Sans Thai', sans-serif;
}

#admin-password:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}

.button-group {
  display: flex;
  gap: 15px;
  justify-content: center;
}

.btn {
  padding: 14px 28px;
  font-size: 16px;
  font-weight: 500;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: var(--transition);
  font-family: 'IBM Plex Sans Thai', sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  min-width: 120px;
}

.btn-primary {
  background-color: var(--primary-color);
  color: white;
}

.btn-primary:hover {
  background-color: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
}

.btn-secondary {
  background-color: #f1f5f9;
  color: var(--dark-color);
}

.btn-secondary:hover {
  background-color: #e2e8f0;
  transform: translateY(-2px);
}

.btn i {
  font-size: 18px;
}

#password-error {
  color: var(--danger-color);
  margin-top: 15px;
  font-size: 14px;
  display: none;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

/* Footer */
.footer {
  text-align: center;
  color: var(--gray-color);
  font-size: 14px;
  padding: 20px;
  margin-top: 20px;
}

.footer a {
  color: var(--primary-color);
  text-decoration: none;
  font-weight: 500;
}

.footer a:hover {
  text-decoration: underline;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 20px;
  }
  
  .control-panel {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .stats-container {
    width: 100%;
    justify-content: space-between;
  }
}

@media (max-width: 768px) {
  .header-title h1 {
    font-size: 24px;
  }
  
  .stats-container {
    flex-wrap: wrap;
  }
  
  .stat-box {
    flex: 1;
    min-width: calc(50% - 10px);
  }
  
  .modal-content {
    padding: 30px 25px;
  }
  
  .button-group {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 10px;
  }
  
  .header {
    padding: 20px;
  }
  
  .control-panel, .calendar-container {
    padding: 20px;
  }
  
  .mode-selector {
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
  }
  
  .select-wrapper {
    width: 100%;
  }
  
  #mode {
    width: 100%;
  }
  
  .stat-box {
    min-width: 100%;
  }
}
</style>
</head>
<body>
<div class="container">
  <!-- Header -->
  <header class="header">
    <div class="header-title">
      <i class="fas fa-calendar-alt"></i>
      <h1>PM <span>Calendar</span> - ระบบปฏิทินจัดการงานซ่อมบำรุง</h1>
    </div>
    <div class="current-date">
      <p id="current-date">วันนี้: กำลังโหลด...</p>
    </div>
  </header>

  <!-- Control Panel -->
  <section class="control-panel">
    <div class="mode-selector">
      <div class="mode-label">
        <i class="fas fa-user-cog"></i> เลือกโหมดการใช้งาน:
      </div>
      <div class="select-wrapper">
        <select id="mode">
          <option value="user">User - โหมดผู้ใช้งาน (ดูอย่างเดียว)</option>
          <option value="admin">Admin - โหมดผู้ดูแลระบบ (แก้ไขได้)</option>
        </select>
        <i class="fas fa-chevron-down"></i>
      </div>
      <div id="mode-status" class="mode-status user">
        <i class="fas fa-eye"></i>
        <span>โหมด: ผู้ใช้งาน</span>
      </div>
    </div>
    
    <div class="stats-container">
      <div class="stat-box">
        <h3>งาน PM ทั้งหมด</h3>
        <p id="total-pm">2</p>
      </div>
      <div class="stat-box">
        <h3>งานเดือนนี้</h3>
        <p id="month-pm">2</p>
      </div>
    </div>
  </section>

  <!-- Calendar -->
  <section class="calendar-container">
    <div id="calendar"></div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <p>PM Calendar System &copy; 2026 | <a href="#" id="help-link"><i class="fas fa-question-circle"></i> ความช่วยเหลือ</a></p>
  </footer>
</div>

<!-- Password Modal -->
<div id="password-modal">
  <div class="modal-content">
    <div class="modal-icon">
      <i class="fas fa-lock"></i>
    </div>
    <h3>กรุณากรอกรหัสผ่านผู้ดูแลระบบ</h3>
    <p>เพื่อเข้าสู่โหมดผู้ดูแลระบบ กรุณากรอกรหัสผ่านที่ได้รับอนุญาต</p>
    
    <div class="password-input-container">
      <i class="fas fa-key"></i>
      <input type="password" id="admin-password" placeholder="ป้อนรหัสผ่านที่นี่...">
    </div>
    
    <div class="button-group">
      <button id="password-submit" class="btn btn-primary">
        <i class="fas fa-check"></i> ยืนยัน
      </button>
      <button id="password-cancel" class="btn btn-secondary">
        <i class="fas fa-times"></i> ยกเลิก
      </button>
    </div>
    
    <p id="password-error">
      <i class="fas fa-exclamation-triangle"></i> รหัสผ่านไม่ถูกต้อง กรุณาลองอีกครั้ง
    </p>
  </div>
</div>

<!-- Help Modal (Hidden) -->
<div id="help-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1001; justify-content: center; align-items: center;">
  <div class="modal-content">
    <div class="modal-icon">
      <i class="fas fa-question-circle" style="color: #f59e0b;"></i>
    </div>
    <h3>คู่มือการใช้งานระบบ</h3>
    <div style="text-align: left; margin-top: 20px;">
      <p><strong>โหมดผู้ใช้งาน (User):</strong></p>
      <ul style="margin-left: 20px; margin-bottom: 15px;">
        <li>ดูข้อมูลงาน Preventive Maintenance (PM) ได้อย่างเดียว</li>
        <li>คลิกที่งานเพื่อดูรายละเอียด</li>
      </ul>
      
      <p><strong>โหมดผู้ดูแลระบบ (Admin):</strong></p>
      <ul style="margin-left: 20px; margin-bottom: 15px;">
        <li>เพิ่มงาน PM ใหม่ได้โดยการคลิกเลือกวันที่ในปฏิทิน</li>
        <li>แก้ไขงาน PM ที่มีอยู่ได้</li>
        <li>ต้องกรอกรหัสผ่านเพื่อเข้าสู่โหมดนี้</li>
      </ul>
      
      <p style="color: var(--gray-color); font-size: 14px;"><i class="fas fa-info-circle"></i> รหัสผ่านเริ่มต้น: <code>admin123</code></p>
    </div>
    <button id="close-help" class="btn btn-primary" style="margin-top: 20px;">
      <i class="fas fa-times"></i> ปิด
    </button>
  </div>
</div>

<script>
// รหัสผ่าน (เปลี่ยนเป็นรหัสที่ต้องการ)
const ADMIN_PASSWORD = "admin123";

let mode = 'user';
let calendar;

// แสดงวันที่ปัจจุบัน
function updateCurrentDate() {
  const now = new Date();
  const options = { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  };
  const dateString = now.toLocaleDateString('th-TH', options);
  document.getElementById('current-date').textContent = `วันนี้: ${dateString}`;
}

// อัพเดทสถิติ
function updateStats() {
  const events = calendar.getEvents();
  document.getElementById('total-pm').textContent = events.length;
  
  const now = new Date();
  const currentMonthEvents = events.filter(event => {
    const eventDate = event.start;
    return eventDate.getMonth() === now.getMonth() && 
           eventDate.getFullYear() === now.getFullYear();
  });
  
  document.getElementById('month-pm').textContent = currentMonthEvents.length;
}

// สร้าง calendar
calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
  initialView: 'dayGridMonth',
  editable: false,
  selectable: false,
  headerToolbar: {
    left: 'prev,next today',
    center: 'title',
    right: 'dayGridMonth,timeGridWeek,timeGridDay'
  },
  buttonText: {
    today: 'วันนี้',
    month: 'เดือน',
    week: 'สัปดาห์',
    day: 'วัน'
  },
  locale: 'th',
  firstDay: 1, // เริ่มต้นวันจันทร์
  
  events: [
    {
      id: '1',
      title: 'PM Generator',
      start: '2026-02-05',
      color: '#4361ee',
      description: 'บำรุงรักษาเครื่องกำเนิดไฟฟ้าตามรอบกำหนด'
    },
    {
      id: '2',
      title: 'PM Aircon',
      start: '2026-02-10',
      color: '#4cc9f0',
      description: 'บำรุงรักษาระบบปรับอากาศ'
    },
    {
      id: '3',
      title: 'PM Fire System',
      start: '2026-02-15',
      color: '#ef4444',
      description: 'ตรวจสอบระบบดับเพลิง'
    },
    {
      id: '4',
      title: 'PM Electrical',
      start: '2026-02-20',
      color: '#f59e0b',
      description: 'ตรวจสอบระบบไฟฟ้า'
    },
    {
      id: '5',
      title: 'PM Elevator',
      start: '2026-02-25',
      color: '#4ade80',
      description: 'บำรุงรักษาลิฟต์'
    }
  ],

  eventClick(info) {
    const eventDate = info.event.start.toLocaleDateString('th-TH', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    
    Swal.fire({
      title: info.event.title,
      html: `
        <p><strong>วันที่:</strong> ${eventDate}</p>
        <p><strong>รายละเอียด:</strong> ${info.event.extendedProps.description || 'ไม่มีรายละเอียดเพิ่มเติม'}</p>
      `,
      icon: 'info',
      confirmButtonText: 'ตกลง',
      confirmButtonColor: '#4361ee',
      background: '#fff',
      color: '#1e293b'
    });
  },

  select(info) {
    if (mode !== 'admin') return;
    
    Swal.fire({
      title: 'เพิ่มงาน PM ใหม่',
      html: `
        <input type="text" id="pm-title" class="swal2-input" placeholder="ชื่องาน PM">
        <textarea id="pm-description" class="swal2-textarea" placeholder="รายละเอียดงาน..."></textarea>
        <p style="text-align: left; margin-top: 10px; font-size: 14px; color: #666;">วันที่: ${info.startStr}</p>
      `,
      focusConfirm: false,
      showCancelButton: true,
      confirmButtonText: 'บันทึก',
      cancelButtonText: 'ยกเลิก',
      confirmButtonColor: '#4361ee',
      cancelButtonColor: '#64748b',
      preConfirm: () => {
        const title = document.getElementById('pm-title').value;
        const description = document.getElementById('pm-description').value;
        
        if (!title) {
          Swal.showValidationMessage('กรุณากรอกชื่องาน PM');
          return false;
        }
        
        return { title, description };
      }
    }).then((result) => {
      if (result.isConfirmed) {
        calendar.addEvent({
          title: result.value.title,
          start: info.startStr,
          allDay: true,
          color: '#7209b7',
          description: result.value.description
        });
        
        updateStats();
        
        Swal.fire({
          title: 'สำเร็จ!',
          text: 'เพิ่มงาน PM เรียบร้อยแล้ว',
          icon: 'success',
          confirmButtonColor: '#4361ee'
        });
      }
    });
  },
  
  eventDrop(info) {
    if (mode !== 'admin') {
      info.revert();
      return;
    }
    
    Swal.fire({
      title: 'ย้ายงานแล้ว',
      text: 'เปลี่ยนแปลงวันที่งานเรียบร้อยแล้ว',
      icon: 'success',
      confirmButtonColor: '#4361ee',
      timer: 1500
    });
    
    updateStats();
  },
  
  eventResize(info) {
    if (mode !== 'admin') {
      info.revert();
      return;
    }
    
    updateStats();
  },
  
  datesSet: function(info) {
    updateStats();
  }
});

calendar.render();
updateCurrentDate();
updateStats();

// อ้างอิง DOM elements
const modeSelect = document.getElementById('mode');
const modeStatus = document.getElementById('mode-status');
const passwordModal = document.getElementById('password-modal');
const adminPasswordInput = document.getElementById('admin-password');
const passwordSubmit = document.getElementById('password-submit');
const passwordCancel = document.getElementById('password-cancel');
const passwordError = document.getElementById('password-error');
const helpLink = document.getElementById('help-link');
const helpModal = document.getElementById('help-modal');
const closeHelp = document.getElementById('close-help');

// เพิ่ม SweetAlert2
const swalScript = document.createElement('script');
swalScript.src = 'https://cdn.jsdelivr.net/npm/sweetalert2@11';
document.head.appendChild(swalScript);

// เมื่อเปลี่ยนโหมด
modeSelect.onchange = e => {
  const selectedMode = e.target.value;
  
  if (selectedMode === 'admin') {
    // แสดง modal รหัสผ่าน
    showPasswordModal();
  } else {
    // เปลี่ยนเป็นโหมด user
    switchToUserMode();
  }
};

// แสดง modal รหัสผ่าน
function showPasswordModal() {
  passwordModal.style.display = 'flex';
  adminPasswordInput.value = '';
  passwordError.style.display = 'none';
  adminPasswordInput.focus();
}

// ซ่อน modal รหัสผ่าน
function hidePasswordModal() {
  passwordModal.style.display = 'none';
}

// เปลี่ยนเป็นโหมด admin
function switchToAdminMode() {
  mode = 'admin';
  calendar.setOption('editable', true);
  calendar.setOption('selectable', true);
  
  // อัพเดท UI โหมด
  modeStatus.className = 'mode-status admin';
  modeStatus.innerHTML = '<i class="fas fa-user-shield"></i><span>โหมด: ผู้ดูแลระบบ</span>';
  modeSelect.value = 'admin';
  
  hidePasswordModal();
  
  // แจ้งเตือน
  Swal.fire({
    title: 'เข้าสู่โหมดผู้ดูแลระบบแล้ว!',
    text: 'ตอนนี้คุณสามารถเพิ่มและแก้ไขงาน PM ได้',
    icon: 'success',
    confirmButtonColor: '#4361ee',
    timer: 2000
  });
}

// เปลี่ยนเป็นโหมด user
function switchToUserMode() {
  mode = 'user';
  calendar.setOption('editable', false);
  calendar.setOption('selectable', false);
  
  // อัพเดท UI โหมด
  modeStatus.className = 'mode-status user';
  modeStatus.innerHTML = '<i class="fas fa-eye"></i><span>โหมด: ผู้ใช้งาน</span>';
  modeSelect.value = 'user';
  
  hidePasswordModal();
}

// ตรวจสอบรหัสผ่าน
function checkPassword() {
  const enteredPassword = adminPasswordInput.value;
  
  if (enteredPassword === ADMIN_PASSWORD) {
    switchToAdminMode();
  } else {
    passwordError.style.display = 'flex';
    adminPasswordInput.value = '';
    adminPasswordInput.focus();
    
    // เอฟเฟกต์สั่น
    adminPasswordInput.style.animation = 'shake 0.5s';
    setTimeout(() => {
      adminPasswordInput.style.animation = '';
    }, 500);
  }
}

// Event listeners
passwordSubmit.onclick = checkPassword;

passwordCancel.onclick = () => {
  switchToUserMode();
};

adminPasswordInput.onkeypress = (e) => {
  if (e.key === 'Enter') {
    checkPassword();
  }
};

// ปิด modal เมื่อคลิกภายนอก
passwordModal.onclick = (e) => {
  if (e.target === passwordModal) {
    switchToUserMode();
  }
};

// ความช่วยเหลือ
helpLink.onclick = (e) => {
  e.preventDefault();
  helpModal.style.display = 'flex';
};

closeHelp.onclick = () => {
  helpModal.style.display = 'none';
};

helpModal.onclick = (e) => {
  if (e.target === helpModal) {
    helpModal.style.display = 'none';
  }
};

// เพิ่มสไตล์สำหรับเอฟเฟกต์สั่น
const style = document.createElement('style');
style.textContent = `
  @keyframes shake {
    0%, 100% {transform: translateX(0);}
    10%, 30%, 50%, 70%, 90% {transform: translateX(-5px);}
    20%, 40%, 60%, 80% {transform: translateX(5px);}
  }
`;
document.head.appendChild(style);
</script>
</body>
</html>
