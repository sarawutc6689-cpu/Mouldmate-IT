<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>PM Calendar + Login</title>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<style>
body {
  font-family: Arial;
  margin: 20px;
}
#loginBox {
  max-width: 300px;
  margin: 100px auto;
  border: 1px solid #ddd;
  padding: 20px;
}
#calendarBox {
  display: none;
}
input, button {
  width: 100%;
  margin-top: 10px;
  padding: 8px;
}
.role {
  margin-bottom: 10px;
  font-weight: bold;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
  <h3>Login</h3>
  <input id="username" placeholder="username">
  <input id="password" type="password" placeholder="password">
  <button onclick="login()">Login</button>
  <p id="error" style="color:red"></p>
</div>

<!-- CALENDAR -->
<div id="calendarBox">
  <div class="role" id="roleText"></div>
  <button onclick="logout()">Logout</button>
  <hr>
  <div id="calendar"></div>
</div>

<script>
/* ===== MOCK USER DATABASE ===== */
const users = {
  admin: { password: '1234', role: 'admin' },
  user:  { password: '1234', role: 'user' }
};

let currentUser = null;
let calendar;

/* ===== LOGIN ===== */
function login() {
  const u = username.value;
  const p = password.value;

  if (!users[u] || users[u].password !== p) {
    error.textContent = 'username หรือ password ไม่ถูกต้อง';
    return;
  }

  currentUser = { username: u, role: users[u].role };
  loginBox.style.display = 'none';
  calendarBox.style.display = 'block';

  roleText.textContent = `Login as: ${currentUser.role.toUpperCase()}`;

  initCalendar();
}

/* ===== LOGOUT ===== */
function logout() {
  location.reload();
}

/* ===== CALENDAR ===== */
function initCalendar() {
  calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay'
    },

    editable: currentUser.role === 'admin',
    selectable: currentUser.role === 'admin',

    events: [
      { title: 'PM Generator', start: '2026-02-05', color: '#1a73e8' },
      { title: 'PM Aircon', start: '2026-02-10', color: '#34a853' }
    ],

    select(info) {
      if (currentUser.role !== 'admin') return;

      const title = prompt('PM Title');
      if (title) {
        calendar.addEvent({
          title,
          start: info.startStr,
          allDay: true
        });
      }
    },

    eventClick(info) {
      if (currentUser.role === 'admin') {
        if (confirm('ลบ PM นี้?')) {
          info.event.remove();
        }
      } else {
        alert(info.event.title);
      }
    }
  });

  calendar.render();
}
</script>

</body>
</html>
